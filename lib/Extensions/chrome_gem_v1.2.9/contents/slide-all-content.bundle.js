(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}}};async function t(e,t,o){const n="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((a,i)=>{n.sendMessage({source:e,type:t,data:o},(e=>{n.lastError?i(new Error(`Error sending message: ${n.lastError.message}`)):a(e)}))}))}catch(e){throw console.error(`[messageHelpers] Error in sending message: ${e.message}`),e}}const o=async(e,t)=>{const o="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,n="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const a=await o.get([e]);if(n.lastError)throw new Error(`Error retrieving ${e}: ${n.lastError.message}`);return null!=a[e]?a[e]:t}catch(t){throw console.error(`[storageHelpers] Error retrieving ${e}:`,t),t}};Promise.resolve();async function n(e){return new Promise((t=>setTimeout(t,e)))}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=document.getElementById("captcha-message");n||(n=document.createElement("div"),n.id="captcha-message",n.style.zIndex="99999999",n.style.padding="3px 3px",n.style.borderRadius="3px",n.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",n.style.fontSize="10px",n.style.fontWeight="600",n.style.fontFamily="Arial, sans-serif",n.style.textAlign="center",n.style.whiteSpace="nowrap",n.style.color="white",n.style.top="1px",o&&o.parentElement?(n.style.position="absolute",n.style.left="2px",o.parentElement.appendChild(n)):(n.style.position="fixed",n.style.left="1px",document.body.appendChild(n)));const a={success:"linear-gradient(90deg, #1e90ff, #00c4ff)",error:"linear-gradient(90deg, #ff5e62, #ff9966)",warning:"linear-gradient(90deg, #ffbb33, #ff9500)",info:"linear-gradient(90deg, #2193b0, #6dd5ed)"};n.innerText="[GEMcaptcha.com] "+e,n.style.background=a[t]||a.success,n.style.display="block"}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timeout:5e3,maxRetries:3};try{const{timeout:o,maxRetries:a}=t,i={arkoselabs:"image/jpeg"};function l(e){for(const[t,o]of Object.entries(i))if(e.includes(t))return o;return"image/png"}if(e instanceof HTMLCanvasElement||e.tagName&&"CANVAS"===e.tagName.toUpperCase())try{if(0===e.width||0===e.height)return console.log("Canvas rỗng hoặc không có kích thước"),"";const c=e.getBoundingClientRect(),r=c.width,s=c.height,u=document.createElement("canvas");u.width=r,u.height=s;u.getContext("2d").drawImage(e,0,0,r,s);const d="image/png",g=u.toDataURL(d).split(",")[1];return g||(console.log("Không thể lấy base64 từ canvas"),"")}catch(h){return console.log("Lỗi khi chụp màn hình canvas:",h),""}if(e instanceof Element)try{const m=e.src;if(m&&m.startsWith("data:image/")){const p=m.split(",")[1];return p||(console.log("Base64 rỗng từ src của element"),"")}e=m||""}catch(f){return console.log("Lỗi khi xử lý element:",f),""}if("string"==typeof e&&e.startsWith("blob:")){console.log("Da vao blob");try{return await new Promise((t=>{const o=new Image;o.setAttribute("crossOrigin","anonymous");const n=setTimeout((()=>{t("")}),1e3);o.onload=function(){console.log("Vao trong onload"),clearTimeout(n);try{const o=document.createElement("canvas");o.width=this.naturalWidth,o.height=this.naturalHeight;o.getContext("2d").drawImage(this,0,0);const n=l(e);o.toBlob((e=>{if(!e)return void t("");const o=new FileReader;o.onloadend=()=>{const e=o.result.split(",")[1];t(e)},o.onerror=()=>t(""),o.readAsDataURL(e)}),n)}catch(e){console.log("Lỗi khi xử lý blob URL:",e),t("")}},o.onerror=()=>{clearTimeout(n),t("")},o.src=e,console.log("This is img:"),console.log("img src:",o.src)}))}catch(w){return console.log("Lỗi khi xử lý blob URL:",w),""}}if("string"==typeof e){console.log("Vao den input string:");try{for(let y=0;y<a;y++)try{const b=new AbortController,k=setTimeout((()=>b.abort()),o),v=await fetch(e,{signal:b.signal});if(clearTimeout(k),!v.ok)throw new Error(`HTTP error ${v.status}`);const S=await v.blob();return await new Promise(((e,t)=>{const o=new FileReader;o.onloadend=()=>e(o.result.split(",")[1]),o.onerror=()=>t(new Error("Failed to read blob as base64")),o.readAsDataURL(S)}))}catch(E){if(y===a-1)return console.log("Hết lượt thử fetch:",E),"";await n(500)}}catch(A){return console.log("Lỗi khi fetch URL:",A),""}}return console.log("Đầu vào không được hỗ trợ:",e),""}catch(T){return console.log("Lỗi chung trong fetchImageToBase64:",T),""}}function l(e,t){return new Promise((o=>{const n=Date.now(),a=setInterval((()=>{for(const t of e){if(document.querySelector(t))return clearInterval(a),void o(!0)}Date.now()-n>=t&&(clearInterval(a),o(!1))}),500)}))}async function c(e){console.log("Vao createTask utils");try{const o=await t("SOURCE","createTask",e);return o||(console.error("No response from createTask"),"")}catch(e){return console.error("Failed to create task:",e),""}}let r,s,u,d,g;async function h(){r=await o(e.POWER_ON.key,e.POWER_ON.defaultValue),s=await o(e.API_KEY.key,e.API_KEY.defaultValue);const t=await o(e.SLIDE_ALL.key,e.SLIDE_ALL.defaultValue);u=t.delaySwipe,d=t.loop,g=t.isActive}console.log("Run file SlideAll");let m=!1,p="";async function f(){for(console.log("[SlideAll] This is captchaKeoThaCoresky");;){let e,t;await n(500);for(let o=0;o<10&&(e=document.querySelector('[class*="mask"][style=""] [class*="verify-img-panel"] img'),t=document.querySelector('[class*="mask"][style=""] [class*="verify-sub-block"] img'),null===e||null===t);o++)await n(1e3);if(!e||!t)return;const o={type:"SliderAllWebTask",domain:"www.coresky.com",imageBase64s:[e.src.split(",")[1],t.src.split(",")[1]]},a=JSON.stringify({clientKey:s,task:o}),i=await c(a);if(!i||i.error){if(d){document.querySelector(".verify-refresh").click();continue}return}const l=await _(s,i.taskId,30);if(console.log("[SlideAll] result:",l),!l||l.errorDescription){if(d){document.querySelector(".verify-refresh").click();continue}return}let r=parseInt(l.end,10);console.log("conutX:",r);let u=document.querySelector(".verify-move-block");if(!u)continue;const g=u.getBoundingClientRect(),h=g.left+g.width/2,m=g.top+g.height/2,p=h+r;u.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,clientX:h,clientY:m}));const f=20;for(let e=1;e<=f;e++){const t=h+r*e/f;u.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,cancelable:!0,clientX:t,clientY:m})),await n(20)}if(u.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,clientX:p,clientY:m})),console.log(`[SlideAll] Đã kéo button sang phải ${r}px`),!d)return;await n(5e3),document.querySelector(".verify-refresh").click()}}async function w(){for(console.log("This is captchaGarena::");;){await n(700);var e=null;for(let t=0;t<10&&null==(e=document.querySelector('[id="captcha__element"] [id="captcha__puzzle"]>canvas'));t++)await n(1e3);if(!e)return;let t="";for(let e=0;e<10;e++){if(t=E(),t&&p!==t){p=t;break}await n(1e3)}if(!t)return;console.log("[SlideAll] This is imgBase64:",t);const o={type:"SliderAllWebTask",imageBase64:t,widthView:e.width,heightView:e.height},a=JSON.stringify({clientKey:s,task:o}),i=await c(a);if(!i||i.error){if(console.log("[SlideAll] Ko có taskId"),d){document.querySelector('button[id="captcha__reload__button"]').click();continue}return}const l=await _(s,i.taskId,30);if(console.log("[SlideAll] result:",l),!l||l.errorDescription){if(console.log("[SlideAll] Ko có result"),d){document.querySelector('button[id="captcha__reload__button"]').click();continue}return}let r=parseInt(l.rects[0].x,10)+12,u=document.querySelector('[id="captcha__frame__bottom"] [class*="sliderContainer"] div[class="slider"]');await T(u,r),await n(3500);if(document.querySelector('[id="captcha__element"] [id="captcha__puzzle"]>canvas')){if(console.warn("[SlideAll] Giải captcha thất bại ❌"),d)continue;return}return void console.log("[SlideAll] Giải captcha thành công ✅ (captcha đã biến mất)")}}async function y(){for(console.log("[SlideAll] This is captchaKeoThaKwai");;){let e,t;await n(500);for(let o=0;o<10&&(e=document.querySelector('[class*="kwai-captcha-page"] [class*="image-container"] img[class="bg-img"]'),t=document.querySelector('[class*="kwai-captcha-page"] [class*="image-container"] img[class="slider-img"]'),null===e||null===t);o++)await n(1e3);if(!e||!t)return;a("Captcha captchaKeoThaKwai","red",e);const o={type:"SliderAllWebTask",imageBase64:await i(e.src),widthView:e.width,heightView:e.height},l=JSON.stringify({clientKey:s,task:o});a("Create task...","red",e);const r=await c(l);if(!r||r.error){const e=r?r.errorDescription:"No response";if(console.log("Lỗi",e),d){document.querySelector(".icon.icon-refresh").click();continue}return}a("Get result...","red",e);const u=await _(s,r.taskId,30);if(console.log("[SlideAll] result:",u),!u||u.errorDescription){if(d){document.querySelector(".icon.icon-refresh").click();continue}return}let g=parseInt(u.rects[0].x,10)-t.offsetLeft;console.log("conutX:",g);let h=document.querySelector(".slider .slider-shadow > div");a("Dragging...","red",e),await T(h,g),await n(3500);if(document.querySelector('[class*="kwai-captcha-page"] [class*="image-container"] img[class="bg-img"]')){if(console.warn("[SlideAll] Giải captcha thất bại ❌"),a("Solve failed","red",e),d)continue;return}return void console.log("[SlideAll] Giải captcha thành công ✅ (captcha đã biến mất)")}}async function b(){for(console.log("[SlideAll] This is captchaKeoThaCoinMarketCap");;){let e,o;await n(500);for(let t=0;t<10&&(e=document.querySelector('[class*="bs-popup"] [class*="bs-main-image"]'),o=document.querySelector(".bs-slide-image"),null===e);t++)await n(1e3);if(!e)return;const a=getComputedStyle(e),i=a.backgroundImage.match(/url\(["']?(.*?)["']?\)/)?.[1];console.log("bgUrl",i);let l="";for(let e=0;e<10;e++){if(l=await t("SLIDE_ALL","createImageBase64",{url:i}),l&&p!==l){p=l;break}await n(1e3)}console.log("[SlideAll] This is backgroundBase64",l),console.log("[SlideAll] This is width imgPuzzle",o.clientWidth);const r={type:"SliderAllWebTask",imageBase64:l,widthView:e.clientWidth+o.clientWidth,heightView:e.clientHeight},u=JSON.stringify({clientKey:s,task:r}),g=await c(u);if(!g||g.error){if(d){document.querySelector(".bs-refresh-icon").click();continue}return}const h=await _(s,g.taskId,30);if(console.log("[SlideAll] result:",h),!h||h.errorDescription){if(d){document.querySelector(".bs-refresh-icon").click();continue}return}let m=parseInt(h.rects[1].x,10)-o.clientWidth;console.log("conutX:",m);let f=document.querySelector(".bs-slide-thumb");await T(f,m),await n(3500);if(document.querySelector('[class*="bs-popup"] [class*="bs-main-image"]')){if(console.warn("[SlideAll] Giải captcha thất bại ❌"),d)continue;return}return void console.log("[SlideAll] Giải captcha thành công ✅ (captcha đã biến mất)")}}async function k(){for(console.log("[SlideAll] This is captchaKeoTha_pixelheroes");;){let e;await n(500);for(let t=0;t<10&&(e=document.querySelector('img[class*="gocaptcha-module_picture"]'),null===e);t++)await n(1e3);if(!e)return;let t="";for(let o=0;o<10;o++){if(t=e.src,t&&p!==t){p=t;break}await n(1e3)}console.log("[SlideAll] This is backgroundBase64",t),console.log("[SlideAll] This is imgBackground clientWidth",e.clientWidth);const o={type:"SliderAllWebTask",imageBase64:t,widthView:e.clientWidth,heightView:e.clientHeight};let a=document.querySelector('[class*="gocaptcha-module_dragBlock"]');const i=JSON.stringify({clientKey:s,task:o}),l=await c(i);if(!l||l.error){if(d){location.reload();continue}return}const r=await _(s,l.taskId,30);if(console.log("[SlideAll] result:",r),!r||r.errorDescription){if(d){location.reload();continue}return}let u=parseInt(r.rects[0].x,10),g=1;console.log("conutX:",u),g=103===u?91:112===u?99:205===u?182:215===u?195:u-15,await A(a,g),await n(3e3);if(!document.querySelector('img[class*="gocaptcha-module_picture"]'))return;location.reload()}}async function v(){for(console.log("[SlideAll] This is captcha_titannet");;){let e;await n(500);for(let t=0;t<10&&(e=document.querySelector('#aliyunCaptcha-window-popup[style*="display: block;"] #aliyunCaptcha-img'),null===e);t++)await n(1e3);if(!e)return;let t="";for(let o=0;o<10;o++){if(o>0&&await n(1e3),t=await i(e.src),t&&p!==t){p=t;break}await n(1e3)}return console.log("[SlideAll] This is backgroundBase64",t),void console.log("[SlideAll] This is imgBackground clientWidth",e.clientWidth)}}function S(e){return!!document.querySelector(e)}function E(){const e=document.querySelectorAll("#captcha__puzzle canvas"),t=e[0],o=e[1],n=document.createElement("canvas");n.width=280,n.height=155;const a=n.getContext("2d");a.drawImage(t,0,0),a.drawImage(o,0,0);const i=n.toDataURL("image/jpeg"),l=i.replace(/^data:image\/jpeg;base64,/,"");return console.log("Base64 đầy đủ:\n",i),console.log("Base64 chỉ phần mã hóa:\n",l),l}async function A(e,t){return new Promise((o=>{if(!e)return o();e.parentElement;const a=t,i=new DataTransfer,l=u;function c(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,...o})),e.dispatchEvent(new PointerEvent(t,{bubbles:!0,cancelable:!0,...o,pointerType:"mouse",isPrimary:!0}))}(async()=>{c("mouseenter"),c("mouseover"),await n(l),c("pointerdown",{clientX:0,clientY:0}),c("mousedown",{clientX:0,clientY:0}),e.dispatchEvent(new DragEvent("dragstart",{bubbles:!0,cancelable:!0,dataTransfer:i}));let r=0,s=0;for(;r+10<t;){const e=r/t;let o;o=e<.3?2*Math.random()+1:e<.7?6*Math.random()+2:2*Math.random()+.5,r+=o,s+=8*(Math.random()-.5);const i=Math.min(r,a),u=s;c("mousemove",{clientX:i,clientY:u}),c("pointermove",{clientX:i,clientY:u}),await n(l)}r=t;const u=s;c("mousemove",{clientX:r,clientY:u}),c("pointermove",{clientX:r,clientY:u}),await n(l),c("pointerup",{clientX:r,clientY:u}),c("mouseup",{clientX:r,clientY:u}),e.dispatchEvent(new DragEvent("dragend",{bubbles:!0,cancelable:!0,dataTransfer:i})),console.log("Vị trí backend >>>",t),console.log(`Vị trí cuối cùng của element: x = ${r}, y = ${u}`),o()})()}))}async function T(e,t){const o=e.getBoundingClientRect(),n=o.left+o.width/2,a=o.top+o.height/2,i=n+t,l={bubbles:!0,cancelable:!0,clientX:n,clientY:a,pointerType:"mouse",buttons:0};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointerover",l)),t.dispatchEvent(new PointerEvent("pointerenter",l)),t.dispatchEvent(new MouseEvent("mouseover",l)),t.dispatchEvent(new MouseEvent("mouseenter",l));await new Promise((e=>setTimeout(e,300)));const c={...l,buttons:1};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointerdown",c)),t.dispatchEvent(new MouseEvent("mousedown",c));const r=12+Math.floor(6*Math.random());for(let o=0;o<=r;o++){const i={bubbles:!0,cancelable:!0,clientX:n+t*(o/r)+2*(Math.random()-.5),clientY:a+3*(Math.random()-.5),pointerType:"mouse",buttons:1};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointermove",i)),t.dispatchEvent(new MouseEvent("mousemove",i));await new Promise((e=>setTimeout(e,35+25*Math.random())))}const s={bubbles:!0,cancelable:!0,clientX:i,clientY:a,pointerType:"mouse",buttons:0};for(const t of[e,document,window])t.dispatchEvent(new PointerEvent("pointerup",s)),t.dispatchEvent(new MouseEvent("mouseup",s));console.log(`[TEST] Đã kéo ${t}px từ (${n}, ${a})`)}async function _(e,o,n){const a=JSON.stringify({clientKey:e,taskId:o});try{const e=await t("SOURCE","getTaskResult",{data:a,timeWait:n});return e?"fail"===e.status?(console.error("API error:",e),{errorDescription:e.errorDescription}):e.solution?e.solution:e.type?e:(console.error("Invalid API response: missing solution"),null):(console.error("No result returned from getTaskResult"),null)}catch(e){return console.error("Failed to get task result:",e),null}}(async()=>{await h();new MutationObserver((async(e,t)=>{await async function(e){if(console.log("Đã vào [SlideAll] handleElementMutation"),await h(),r&&g&&s&&"YOUR_CLIEN_KEY"!==s)for(const t of e)if("childList"===t.type){const e=document.querySelector('[class*="kwai-captcha-page"] [class*="image-container"]'),t=document.querySelector('[class*="bs-popup"] [class*="bs-main-image"]');if(!e&&!t||m)continue;if(console.log("[SlideAll] Da thay target Element"),!s)return;m=!0;try{if(await n(1500),!await l(['[class*="kwai-captcha-page"] [class*="image-container"] img','[class*="bs-popup"] [class*="bs-main-image"]'],1e4))return;console.log("[SlideAll] Tìm thấy elementExists");for(let e=0;e<20;e++){if(S('[class*="kwai-captcha-page"] [class*="image-container"] img[class="bg-img"]')){await y();break}if(S('[class*="bs-popup"] [class*="bs-main-image"]')){await b();break}await n(1e3)}}finally{m=!1}}}(e)})).observe(document.body,{childList:!0,subtree:!0});const e={"www.coresky.com":{captchaImageSelector:'[class*="mask"][style=""] [class*="verify-img-panel"] img',function:f},"dapp.pixelheroes.io":{captchaImageSelector:'img[class*="gocaptcha-module_picture"]',function:k},"edge.titannet.info":{captchaImageSelector:'#aliyunCaptcha-window-popup[style*="display: block;"] #aliyunCaptcha-img',function:v},"geo.captcha-delivery.com":{captchaImageSelector:'[id="captcha__element"] [id="captcha__puzzle"] canvas[class="block"]',function:w}},t=window.location.hostname,o=e[t];if(console.log("This is hostname:",t),o){let a=!1;async function i(e){if(r&&g&&s&&"YOUR_CLIEN_KEY"!==s&&!a){a=!0,console.log("[SlideAll] Phát hiện captcha, bắt đầu xử lý...");try{await o.function()}catch(e){console.error("[SlideAll] Lỗi xử lý captcha:",e)}finally{a=!1}}}(async()=>{for(let e=0;e<100;e++){const e=document.querySelector(o.captchaImageSelector);if(e){await i();break}await n(1500)}})();new MutationObserver((()=>{const e=document.querySelector(o.captchaImageSelector);e&&i()})).observe(document.body,{childList:!0,subtree:!0})}else console.log("[SlideAll] Không có config cho trang:",t)})()})();