(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}}};async function t(e,t,o){const a="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((c,r)=>{a.sendMessage({source:e,type:t,data:o},(e=>{a.lastError?r(new Error(`Error sending message: ${a.lastError.message}`)):c(e)}))}))}catch(e){throw console.error(`[messageHelpers] Error in sending message: ${e.message}`),e}}const o=async(e,t)=>{const o="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,a="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const c=await o.get([e]);if(a.lastError)throw new Error(`Error retrieving ${e}: ${a.lastError.message}`);return null!=c[e]?c[e]:t}catch(t){throw console.error(`[storageHelpers] Error retrieving ${e}:`,t),t}};Promise.resolve();async function a(e){return new Promise((t=>setTimeout(t,e)))}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timeout:5e3,maxRetries:3};try{const{timeout:o,maxRetries:c}=t,r={arkoselabs:"image/jpeg"};function n(e){for(const[t,o]of Object.entries(r))if(e.includes(t))return o;return"image/png"}if(e instanceof HTMLCanvasElement||e.tagName&&"CANVAS"===e.tagName.toUpperCase())try{if(0===e.width||0===e.height)return console.log("Canvas rỗng hoặc không có kích thước"),"";const i=e.getBoundingClientRect(),l=i.width,s=i.height,u=document.createElement("canvas");u.width=l,u.height=s;u.getContext("2d").drawImage(e,0,0,l,s);const g="image/png",h=u.toDataURL(g).split(",")[1];return h||(console.log("Không thể lấy base64 từ canvas"),"")}catch(m){return console.log("Lỗi khi chụp màn hình canvas:",m),""}if(e instanceof Element)try{const p=e.src;if(p&&p.startsWith("data:image/")){const d=p.split(",")[1];return d||(console.log("Base64 rỗng từ src của element"),"")}e=p||""}catch(f){return console.log("Lỗi khi xử lý element:",f),""}if("string"==typeof e&&e.startsWith("blob:")){console.log("Da vao blob");try{return await new Promise((t=>{const o=new Image;o.setAttribute("crossOrigin","anonymous");const a=setTimeout((()=>{t("")}),1e3);o.onload=function(){console.log("Vao trong onload"),clearTimeout(a);try{const o=document.createElement("canvas");o.width=this.naturalWidth,o.height=this.naturalHeight;o.getContext("2d").drawImage(this,0,0);const a=n(e);o.toBlob((e=>{if(!e)return void t("");const o=new FileReader;o.onloadend=()=>{const e=o.result.split(",")[1];t(e)},o.onerror=()=>t(""),o.readAsDataURL(e)}),a)}catch(e){console.log("Lỗi khi xử lý blob URL:",e),t("")}},o.onerror=()=>{clearTimeout(a),t("")},o.src=e,console.log("This is img:"),console.log("img src:",o.src)}))}catch(w){return console.log("Lỗi khi xử lý blob URL:",w),""}}if("string"==typeof e){console.log("Vao den input string:");try{for(let y=0;y<c;y++)try{const k=new AbortController,b=setTimeout((()=>k.abort()),o),C=await fetch(e,{signal:k.signal});if(clearTimeout(b),!C.ok)throw new Error(`HTTP error ${C.status}`);const v=await C.blob();return await new Promise(((e,t)=>{const o=new FileReader;o.onloadend=()=>e(o.result.split(",")[1]),o.onerror=()=>t(new Error("Failed to read blob as base64")),o.readAsDataURL(v)}))}catch(S){if(y===c-1)return console.log("Hết lượt thử fetch:",S),"";await a(500)}}catch(I){return console.log("Lỗi khi fetch URL:",I),""}}return console.log("Đầu vào không được hỗ trợ:",e),""}catch(E){return console.log("Lỗi chung trong fetchImageToBase64:",E),""}}const r=window.location.hostname,n={"www.facebook.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'input[id*="_r_"]'},"en-gb.facebook.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'input[id*="_r_"]'},"m.facebook.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'input[id*="captcha_response"]'},"free.facebook.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'input[id*="captcha_response"]'},"signin.aws.amazon.com":{captchaImageSelector:'[class*="awsui_child"] img[id*="captcha_image"]',inputSelector:'[class*="awsui"] input[class*="awsui_input"]'},"2captcha.com":{captchaImageSelector:'img[class*="_captchaImage"]',inputSelector:'input[id*="simple-captcha-field"]'},"demos.telerik.com":{captchaImageSelector:'img[id*="_CaptchaImage"]',inputSelector:'input[class*="rfdTextInput"]'},"captcha.com":{captchaImageSelector:'img[id*="demoCaptcha_CaptchaImage"]',inputSelector:'input[id*="captchaCode"]'},"register.rediff.com":{captchaImageSelector:'[class="captchaImageCnt"] img[class*="captchaImage"]',inputSelector:'form[name*="register_mail"] input[class*="captcha"]'},"iforgot.apple.com":{captchaImageSelector:'[class="idms-captcha-wrapper"] [class*="img-wrapper"] img',inputSelector:'[class*="captcha-input-container"] input[class*="captcha-input"]'},"id.zing.vn":{captchaImageSelector:'img[src*="zing.vn/captcha2"]',inputSelector:'input[name="captcha"]'},"accounts.zoho.com":{captchaImageSelector:'img[id*="captcha-image"]',inputSelector:'.captcha_holder input[id*="captcha"]'}}[r];let i,l;console.log("[image-to-text] This is hostname:",r),n||console.log("[image-to-text] Không có config cho trang:",r),console.log("Run file ImageToText",window.location.href);let s="",u=!1;async function g(){if(u)return;console.log("Running captchaImageToText");const e=document.querySelector(n.inputSelector);if(!e)return;let o=null;for(let e=0;e<10&&(o=document.querySelector(n.captchaImageSelector),!o);e++)await a(1e3);if(!o)return;let i="";for(let e=0;e<10;e++){switch(r){case"signin.aws.amazon.com":case"www.facebook.com":case"en-gb.facebook.com":case"m.facebook.com":case"free.facebook.com":case"id.zing.vn":case"accounts.zoho.com":i=await t("IMAGETOTEXT","createImageBase64",{url:o.src});break;case"register.rediff.com":i=h(o);break;default:i=await c(o)}if(i&&i!==s){s=i;break}await a(1e3)}if(!i)return;console.log("[image-to-text] This is base64",i);const g=JSON.stringify({clientKey:l,task:{type:"ImageToTextTask",imageBase64:i}}),m=await async function(e){console.log("Vao createTask utils");try{return await t("SOURCE","createTask",e)||(console.error("No response from createTask"),"")}catch(e){return console.error("Failed to create task:",e),""}}(g);if(!m||m.error)return;const p=await async function(e,o,a){const c=JSON.stringify({clientKey:e,taskId:o});try{const e=await t("SOURCE","getTaskResult",{data:c,timeWait:a});return e?"fail"===e.status?(console.error("API error:",e),{errorDescription:e.errorDescription}):e.solution?e.solution:e.type?e:(console.error("Invalid API response: missing solution"),null):(console.error("No result returned from getTaskResult"),null)}catch(e){return console.error("Failed to get task result:",e),null}}(l,m.taskId,30);p&&!p.errorDescription&&(e.value=p.text,e.dispatchEvent(new Event("input",{bubbles:!0})),u=!0,console.log("[image-to-text] Captcha solved successfully, stop solving."))}function h(e){try{const t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;return t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png").replace(/^data:image\/png;base64,/,"")}catch(e){return console.error("Lỗi khi xử lý ảnh bằng canvas:",e),""}}(async()=>{await async function(){i=await o(e.POWER_ON.key,e.POWER_ON.defaultValue),l=await o(e.API_KEY.key,e.API_KEY.defaultValue)}(),await async function(){if(i&&l&&"YOUR_CLIEN_KEY"!==l&&n){console.log("[image-to-text] Bắt đầu quét tìm captcha...");for(let e=0;e<15;e++){if(u){console.log("[image-to-text] Captcha đã được giải, dừng quét.");break}if(document.querySelector(n.captchaImageSelector)){console.log(`[image-to-text] Tìm thấy ảnh captcha ở lần thử thứ ${e+1}. Bắt đầu giải...`);try{await g()}catch(e){console.error("[image-to-text] Lỗi khi đang giải captcha:",e)}break}console.log(`[image-to-text] Lần thử ${e+1}/20: Không tìm thấy captcha. Đang chờ...`),await a(1e3)}console.log("[image-to-text] Kết thúc quá trình quét tìm captcha.")}else console.log("[image-to-text] Đang tắt image-to-text")}();const c=await o(e.CLOUDFLARE.key,e.CLOUDFLARE.defaultValue);let r=c.isActive||!1,s=c.delayClick||2e3,h=await t(null,"getURL",null);console.log("url omo",h),!h.includes("omocaptcha.com")&&location.href.match("challenges.cloudflare.com/cdn-cgi/challenge-platform/")&&r&&i&&l&&"YOUR_CLIEN_KEY"!==l&&(console.log("match cloudflare:",location.href),function(e){console.log("Cloudflare CAPTCHA Solver: Script injected.");const t=chrome.dom.openOrClosedShadowRoot(document.body);if(!t)return void console.error("Cloudflare CAPTCHA Solver: Không thể truy cập Shadow DOM.");const o=setInterval((()=>{const e=document.getElementById("success");if(e&&"visible"===getComputedStyle(e).visibility)return console.log("Cloudflare CAPTCHA Solver: Đã giải quyết thành công!"),void clearInterval(o);const a=t.querySelector("#content > div > div > label");var c;a?(console.log("Cloudflare CAPTCHA Solver: Tìm thấy checkbox, đang thực hiện click..."),c=a,["pointerdown","mousedown","mouseup","click"].forEach((function(e){c.dispatchEvent(new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window}))}))):console.log("Cloudflare CAPTCHA Solver: Đang chờ checkbox xuất hiện...")}),e)}(s))})()})();