(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}}};async function t(e,t,r){const l="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((a,o)=>{l.sendMessage({source:e,type:t,data:r},(e=>{l.lastError?o(new Error(`Error sending message: ${l.lastError.message}`)):a(e)}))}))}catch(e){throw console.error(`[messageHelpers] Error in sending message: ${e.message}`),e}}const r=async(e,t)=>{const r="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,l="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const a=await r.get([e]);if(l.lastError)throw new Error(`Error retrieving ${e}: ${l.lastError.message}`);return null!=a[e]?a[e]:t}catch(t){throw console.error(`[storageHelpers] Error retrieving ${e}:`,t),t}};Promise.resolve();async function l(e){return new Promise((t=>setTimeout(t,e)))}async function a(e){console.log("Vao createTask utils");try{const r=await t("SOURCE","createTask",e);return r||(console.error("No response from createTask"),"")}catch(e){return console.error("Failed to create task:",e),""}}let o,c,n,s,i;async function u(){o=await r(e.POWER_ON.key,e.POWER_ON.defaultValue),c=await r(e.API_KEY.key,e.API_KEY.defaultValue);const t=await r(e.ZALO.key,e.ZALO.defaultValue);n=t.delayClick,s=t.loop,i=t.isActive}console.log("Run file zalo...",window.location.href);let d=!1;async function y(){for(var e="",t=0;t<30;t++){if(await l(1e3),f(['[class*="challenge-container"] [class="challenge-view"]>div[style*="color: red"]'])){var r=h('[class*="challenge-container"] [class="challenge-view"]>div[style*="color: red"]');if(console.log("Text Error:",r),r.length>0){if(s){document.querySelector('[class*="challenge-container"] [class="challenge-view"] div[style*="refresh.png"]').click();continue}return void console.log("Giải captcha thất bại")}}var o=document.querySelector('[class*="challenge-container"] [class="challenge-view"] img');if(o&&e!==o.src){var i=h('[class*="challenge-container"] [class="challenge-view"]>div[class*="1320"]');if(null===i)continue;i=i.trim(),console.log("Câu hỏi Select Object :",i),e=o.src;const t=JSON.stringify({clientKey:c,task:{type:"ZaloSelectObjectTask",imageUrl:e,other:i}}),r=await a(t);if(!r||r.error){if(s){document.querySelector('[class*="challenge-container"] [class="challenge-view"] div[style*="refresh.png"]').click();continue}}else{const e=await k(c,r.taskId,30);if((!e||e.errorDescription)&&s){document.querySelector('[class*="challenge-container"] [class="challenge-view"] div[style*="refresh.png"]').click();continue}console.log("Kết quả:",e);for(const t of e.objects){let e=parseInt(t,10);document.querySelectorAll("tr>td")[e-1].click(),await l(n)}await l(1e3),document.querySelector('[class*="challenge-container"] [class="challenge-view"]>div>div>div').click()}}}}function f(e){for(const t of e){const e=document.querySelector(t);if(e)return e}return null}function g(e){return!!document.querySelector(e)}async function w(e,t){const r=Date.now()+t;for(;Date.now()<r;){for(const t of e){if(document.querySelector(t))return!0}await l(500)}return!1}function h(e){const t=document.querySelector(e);return t?t.textContent.trim():""}async function k(e,r,l){const a=JSON.stringify({clientKey:e,taskId:r});try{const e=await t("SOURCE","getTaskResult",{data:a,timeWait:l});return e?"fail"===e.status?(console.error("API error:",e),{errorDescription:e.errorDescription}):e.solution?e.solution:e.type?e:(console.error("Invalid API response: missing solution"),null):(console.error("No result returned from getTaskResult"),null)}catch(e){return console.error("Failed to get task result:",e),null}}new MutationObserver((async(e,t)=>{await async function(e){if(await u(),o&&i&&c&&"YOUR_CLIEN_KEY"!==c)for(const t of e)if("childList"===t.type&&document.querySelector('[class*="challenge-container"]')&&!d){d=!0,await l(1e3);try{if(!await w(['[class="challenge-view"] img'],1e4))return;for(let e=0;e<20;e++){if(g('[class="challenge-view"] img')){await y();break}await l(500)}}catch(e){console.error("Captcha xử lý lỗi:",e)}finally{d=!1}}}(e)})).observe(document.body,{childList:!0,subtree:!0}),(async()=>{await u()})()})();